<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å ºãƒ¬ãƒ¼ã‚·ãƒ³ã‚°å”ä¼š - è²·ã„ç›®ç™»éŒ²</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #e8f5e9; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 500px; margin-bottom: 20px; box-sizing: border-box; }
        h1, h2 { color: #2e7d32; margin-top: 0; font-size: 1.5em; }
        label { font-size: 0.85em; color: #666; font-weight: bold; }
        input, select, button { margin: 5px 0 10px 0; padding: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
        button#submitBtn { background: #2e7d32; color: white; border: none; font-weight: bold; font-size: 1.2em; cursor: pointer; margin-top: 10px; }
        
        /* æ•°å­—ãƒœã‚¿ãƒ³ï¼ˆãƒ†ãƒ³ã‚­ãƒ¼ï¼‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .num-pad { display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; margin-bottom: 15px; background: #f1f8e9; padding: 8px; border-radius: 8px; }
        .num-pad button { margin: 0; padding: 8px 0; background: white; font-size: 0.9em; color: #333; border: 1px solid #c8e6c9; }
        .num-pad button:active { background: #c8e6c9; }
        .num-pad button.clear-btn { background: #ffecb3; grid-column: span 2; }

        .bet-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .bet-item { border-bottom: 1px solid #eee; padding: 12px 0; }
        .user-name { font-weight: bold; color: #333; }
        .bet-content { color: #d32f2f; font-weight: bold; margin-left: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <h1>ğŸ‡ è²·ã„ç›®ç™»éŒ²</h1>
        <label>ãƒ¡ãƒ³ãƒãƒ¼</label>
        <select id="member">
            <option value="ä»Šå†…">ä»Šå†…</option>
            <option value="å°æ—">å°æ—</option>
            <option value="å‚äº•">å‚äº•</option>
            <option value="æ©‹æœ¬">æ©‹æœ¬</option>
            <option value="å±±æ‘">å±±æ‘</option>
        </select>

        <label>ãƒ¬ãƒ¼ã‚¹å</label>
        <input type="text" id="raceName" placeholder="ä¾‹ï¼šä¸­å±±11R æœ‰é¦¬è¨˜å¿µ">
        
        <label>è²·ã„ç›®ï¼ˆæ•°å­—ãƒœã‚¿ãƒ³ã§å…¥åŠ›ï¼‰</label>
        <div id="bet-containers">
            <script>
                for(let i=1; i<=5; i++){
                    document.write(`
                        <div class="bet-row">
                            <select id="type${i}" style="width: 35%;"><option>å˜å‹</option><option>è¤‡å‹</option><option>é¦¬é€£</option><option>ãƒ¯ã‚¤ãƒ‰</option><option>é¦¬å˜</option><option>3é€£è¤‡</option><option>3é€£å˜</option></select>
                            <input type="text" id="bet${i}" placeholder="è²·ã„ç›® ${i}" style="width: 65%;" readonly>
                        </div>
                        <div class="num-pad">
                            ${[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18].map(n => `<button type="button" onclick="addNum(${i}, ${n})">${n}</button>`).join('')}
                            <button type="button" class="clear-btn" onclick="clearNum(${i})">æ¶ˆå»</button>
                        </div>
                    `);
                }
            </script>
        </div>
        
        <button id="submitBtn">ç™»éŒ²ã™ã‚‹ï¼</button>
    </div>

    <div class="card">
        <h2>ğŸ“Š ã¿ã‚“ãªã®äºˆæƒ³ä¸€è¦§</h2>
        <div id="betList">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAZRvZcA5ARtd0E5tvdn5Z9rOuUCRfw9ww",
            authDomain: "sakai-racing-association.firebaseapp.com",
            projectId: "sakai-racing-association",
            storageBucket: "sakai-racing-association.firebasestorage.app",
            messagingSenderId: "596238260555",
            appId: "1:596238260555:web:df79f88e8c81e6573930ce",
            measurementId: "G-JRJCYSYENL"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // æ•°å­—å…¥åŠ›ã®è£œåŠ©é–¢æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«
        window.addNum = (row, num) => {
            const el = document.getElementById(`bet${row}`);
            if (el.value === "") { el.value = num; } 
            else { el.value += "-" + num; }
        };
        window.clearNum = (row) => {
            document.getElementById(`bet${row}`).value = "";
        };

        // ä¿å­˜ã®å‡¦ç†
        document.getElementById('submitBtn').addEventListener('click', async () => {
            const uName = document.getElementById('member').value;
            const rName = document.getElementById('raceName').value;
            
            const bets = [];
            for (let i = 1; i <= 5; i++) {
                const type = document.getElementById(`type${i}`).value;
                const val = document.getElementById(`bet${i}`).value;
                if (val) bets.push(`${type} ${val}`);
            }
            const bContent = bets.join(" / ");

            if(!rName || !bContent) return alert("ãƒ¬ãƒ¼ã‚¹åã¨è²·ã„ç›®1ã¯å…¥åŠ›ã—ã¦ãã ã•ã„");

            try {
                await addDoc(collection(db, "bets"), {
                    name: uName, race: rName, bet: bContent, createdAt: serverTimestamp()
                });
                document.getElementById('raceName').value = "";
                for (let i = 1; i <= 5; i++) { document.getElementById(`bet${i}`).value = ""; }
                alert("ç™»éŒ²ã—ã¾ã—ãŸï¼");
            } catch (e) { alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); }
        });

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºã®å‡¦ç†
        const q = query(collection(db, "bets"), orderBy("createdAt", "desc"));
        onSnapshot(q, (snapshot) => {
            const betList = document.getElementById('betList');
            betList.innerHTML = "";
            if (snapshot.empty) {
                betList.innerHTML = "ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
                return;
            }
            snapshot.forEach((doc) => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'bet-item';
                div.innerHTML = `<span class="user-name">ğŸ‡ ${data.name || 'ä¸æ˜'}</span> <small>${data.race || ''}</small><br><span class="bet-content">${data.bet || ''}</span>`;
                betList.appendChild(div);
            });
        });
    </script>
</body>
</html>
